<!DOCTYPE html>
<body>
<p>Draw three points on the canvas: 10px green on the positive x axis, 10px red at the center, and
20px yellow on the positive y axis.
<p><canvas id=canvas></canvas>
<script type="x-shader/x-vertex" id="vsource">
uniform mediump float size;
uniform highp vec2 pos;
void main() {
	gl_Position = vec4(pos, 0.0, 1.0);
	gl_PointSize = size;
}
</script>
<script type="x-shader/x-fragment" id="fsource">
uniform mediump vec3 color;
void main() {
	gl_FragColor = vec4(color, 1.0);
}
</script>
<script>
// Helper functions to build the program from shader source (see Lesson 02 for details).
// Note: we're using script tags in the HTML for the shader source code. There's nothing special
// about this technique. It's just the cleanest way to specify multiline strings in JavaScript.
// Any method of specifying a string will work.
// You need to specify the type attribute of the script tags for the shader source, so they don't
// get interpreted as JavaScript.
function buildShaderFromScript(scriptname, shadertype) {
	var source = document.getElementById(scriptname).text
	var shader = gl.createShader(shadertype)
	gl.shaderSource(shader, source)
	gl.compileShader(shader)
	if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
		throw "Error compiling shader " + scriptname + ":\n" + gl.getShaderInfoLog(shader)
	}
	return shader
}
function buildProgramFromScripts(vscriptname, fscriptname) {
	var prog = gl.createProgram()
	gl.attachShader(prog, buildShaderFromScript(vscriptname, gl.VERTEX_SHADER))
	gl.attachShader(prog, buildShaderFromScript(fscriptname, gl.FRAGMENT_SHADER))
	gl.linkProgram(prog)
	if (!gl.getProgramParameter(prog, gl.LINK_STATUS)) {
		throw "Error linking program:\n" + gl.getProgramInfoLog(prog)
	}
	return prog
}

// Set up the gl context and clear it to opaque black.
var gl = document.getElementById("canvas").getContext("webgl")
gl.canvas.width = 854
gl.canvas.height = 480
gl.viewport(0, 0, 854, 480)
gl.clearColor(0, 0, 0, 1)
gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)

var prog = buildProgramFromScripts("vsource", "fsource")
gl.useProgram(prog)

// Output: 3
console.log("Number of active uniforms:", gl.getProgramParameter(prog, gl.ACTIVE_UNIFORMS))

console.log("Info for uniform #0", gl.getActiveUniform(prog, 0))
console.log("Info for uniform #1", gl.getActiveUniform(prog, 1))
console.log("Info for uniform #2", gl.getActiveUniform(prog, 2))

// The WebGLUniformLocation objects corresponding to the program uniforms.
var pos = gl.getUniformLocation(prog, "pos")
var size = gl.getUniformLocation(prog, "size")
var color = gl.getUniformLocation(prog, "color")

// A 10px green point along the positive x axis (0.5, 0)
gl.uniform2f(pos, 0.5, 0)
// Output: [0.5, 0]
console.log("Value of uniform pos:", gl.getUniform(prog, pos))
gl.uniform1f(size, 10)
gl.uniform3f(color, 0, 1, 0)
// Draw a single point with the specified uniforms.
gl.drawArrays(gl.POINTS, 0, 1)

// A 10px red point at the center (0, 0).
// We don't need to update size if it's the same as before.
gl.uniform2f(pos, 0, 0)
gl.uniform3f(color, 1, 0, 0)
gl.drawArrays(gl.POINTS, 0, 1)

// A 20px yellow point along the positive y axis (0, 0.5)
// The vector (v) forms of the update functions takes an Array.
gl.uniform2fv(pos, [0, 0.5])
gl.uniform1fv(size, [20])
gl.uniform3fv(color, [1, 1, 0])
gl.drawArrays(gl.POINTS, 0, 1)

</script>

